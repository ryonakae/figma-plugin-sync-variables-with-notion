# プロジェクトのコーディング規約と開発ガイドライン

## プロジェクト概要
- **目的**: 変数同期を主な機能とするNotion連携プラグイン
- **UI設計**: RelaunchButtonsを使用してFigma上から直接アクセス可能
- **セキュリティ**: NetworkAccessは特定のドメイン（workers.dev）のみ許可

### アーキテクチャ

#### ファイル構成
- `src/main`: Figma API と対話するコード
- `src/ui`: UI コンポーネントと関連ロジック
- `src/@types`: 型定義ファイル
- `src/constants.ts`: 定数定義

#### 状態管理
- Zustandを使用した複数のストアでの状態分離
  - `useSettingsStore`: 永続的な設定
  - `useTmpSettingsStore`: 一時的な設定
- 定数・デフォルト値は`constants.ts`に一元管理

#### UI設計原則
- コンポーネントの再利用と単一責任の原則に従う設計
- 機能ごとにタブに分けた構成
- 空状態・ローディング状態の適切な処理

## 技術スタック

### コア技術
- **TypeScript 5.8.2**: 静的型付け言語
- **Preact 10.26.4**: 軽量な React 互換ライブラリ
- **@figma/plugin-typings 1.108.0**: Figma Plugin SDK
- **TailwindCSS 4.0.17**: ユーティリティファーストのCSS
- **Zustand 5.0.3**: シンプルな状態管理
- **Biome 1.9.4**: 高速なリンター・フォーマッター

### 補助ライブラリ
- **Figmaプラグイン開発**
  - @create-figma-plugin/ui 4.0.0-alpha.0: UI コンポーネント
  - @create-figma-plugin/utilities 4.0.0-alpha.0: ユーティリティ
- **UI機能拡張**
  - @dnd-kit/core 6.3.1 & @dnd-kit/sortable 10.0.0: ドラッグ&ドロップ
  - @tanstack/react-virtual 3.13.3: 仮想化リスト 
  - @fortawesome/fontawesome-svg-core 6.7.2: アイコン
- **ユーティリティ**
  - react-use 17.6.0: フックコレクション
  - tailwind-merge 3.0.2: Tailwindクラスの結合

## コーディング規約

### 言語・フレームワーク規約
- **TypeScript**
  - 厳格な型付けを使用し、`any`型を避ける
  - イベントハンドラー型は`eventHandler.d.ts`で定義
  - グローバル型定義は`@types/`内の`.d.ts`ファイルに集約
- **Preact**
  - 関数コンポーネントとHooksの使用を基本とする
  - JSX記法は`/** @jsx h */`指定と`import { h } from 'preact'`を必須とする
  - コンポーネントにはJSDocでの説明コメントを追加

### コードスタイル
- **インポート規則**
  - 相対パスではなく`@/`エイリアスを使用（@は`src/`を指す）
  - `.tsx`ファイルは1行目に`/** @jsx h */`、2行目に`import { h } from 'preact'`
  - `declare global {}`内の型定義は明示的なインポート不要
- **スタイリング**
  - Tailwind CSSクラスを基本とする
  - クラス結合には`twMerge`関数を使用
  - 動的スタイルには`group`と`group-hover`パターンを活用
- **状態管理**
  - ローカル状態はReact Hooks
  - グローバル状態はZustand
  - フォーム状態は適切なライブラリを選定

### コンポーネント設計
- **基本原則**
  - 単一責任の原則を厳守
  - 再利用可能な小さなコンポーネントへの分割
  - 20行以上のJSXは分割検討対象
- **型定義**
  - Propsの型定義はファイル上部で宣言
  - 型名は目的を示す名前+`Props`（例：`ButtonProps`）
  - オプショナルpropsには`?`修飾子を使用
- **イベント処理**
  - ハンドラー関数は`handle`プレフィックスで統一
  - バブリング制御は明示的に実装
  - イベント発火（emit）は型安全に定義

### 命名規則
- **ファイル命名**
  - コンポーネント: PascalCase（例：`Button.tsx`）
  - 通常ファイル: camelCase
  - 型定義: `.d.ts`拡張子
- **コンポーネント命名**
  - 役割を明確に表す名前（例：`Header`、`Sidebar`）
  - 機能を示す接尾辞（例：`Button`、`List`、`Item`）
- **関数命名**
  - イベントハンドラー: `handle` + イベント名
  - ゲッター関数: `get` + 対象
  - 真偽値関数: `is`/`has`/`should` + 状態
- **変数命名**
  - 一般変数: camelCase
  - 配列: 複数形名詞
  - 真偽値: `is`/`has`/`should` + 状態
  - 定数: UPPER_SNAKE_CASE

## フォーマット規則

- **基本ルール**
  - インデント: スペース2つ
  - 引用符: シングルクォート (`'`)
  - セミコロン: 必要な場合のみ
  - 末尾カンマ: 必須
- **関数構文**
  - アロー関数: 引数1つの場合は括弧省略可
  - メソッドチェーン: 適切な改行で可読性向上
- **コメント**
  - コードの「なぜ」を説明する目的で使用
  - JSDoc形式でAPI文書を生成可能に
  - 自明なコードへのコメントは避ける

## エラー処理とデバッグ

- **エラー検出**
  - 前提条件チェックを必ず実装
  - 早期リターンパターンで条件分岐をフラット化
  - バリデーションは入力直後に実行
- **エラー表示**
  - 具体的かつ対処可能なメッセージ
  - ユーザー向けとログ向けを区別
  - i18n対応を考慮した設計
- **非同期処理**
  - `async/await`を基本とする
  - エラーは適切に`await/catch`または`try/catch`で捕捉
  - ローディング状態を適切に管理

## コードレビュー基準

- **品質要件**
  - 型安全性の確保（TypeScriptの厳格モード活用）
  - 高い可読性と明確な意図の表現
  - コード規約・フォーマットの遵守
- **実装評価**
  - コンポーネント分割の適切さ
  - 状態管理の効率性
  - エラー処理の堅牢性
  - パフォーマンスへの配慮
- **ドキュメント**
  - 適切な場所への説明コメント
  - 複雑なロジックの解説
  - API使用方法の明示
- **テストの観点**
  - エッジケースの考慮
  - 異常系の適切な処理
  - ユーザー体験の一貫性
